#!/usr/bin/env bash

export CVE_PATCHES_DIR=CVE-patches
export RCLONE_DIR=rclone

set -x
env

set -e -o pipefail

# Replace saferith in rclone with fix for s390x
cat <<EOF >>"${RCLONE_DIR}"/go.mod

replace github.com/cronokirby/saferith => ../${CVE_PATCHES_DIR}/saferith
EOF

# Replace golang.org/x/crypto with v0.45.0 for CVE-2025-47913
cat <<EOF >>"${RCLONE_DIR}"/go.mod

replace golang.org/x/crypto => ../${CVE_PATCHES_DIR}/crypto_v0.45.0
EOF

# cat "${RCLONE_DIR}"/go.mod
